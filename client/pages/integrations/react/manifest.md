# React Integration - Manifest

The `manifest.ts` file handles deployment-specific contract information across different networks in your Dojo game. It automatically switches between local development, testnet, and mainnet environments while providing sensible fallbacks for multi-network support.

## 📁 File Structure

```typescript
// src/config/manifest.ts
import localhost from "../../../contract/manifest_dev.json"; // local development manifest
import sepolia from "./manifest_sepolia.json"; // sepolia manifest
import mainnet from "./manifest_sepolia.json"; // change for the right mainnet manifest
import slot from "./manifest_sepolia.json"; // change for the right slot manifest

// Define valid deploy types
type DeployType = keyof typeof manifests;

// Create the manifests object
const manifests = {
  localhost,
  mainnet,
  sepolia,
  slot,
};

// Get deployment type from environment with fallback
const deployType = import.meta.env.VITE_PUBLIC_DEPLOY_TYPE as string;

// Export the appropriate manifest with a fallback
export const manifest = deployType in manifests
  ? manifests[deployType as DeployType]
  : sepolia;

export type Manifest = typeof manifest;
```

## 🎮 Gaming Context

In a Dojo game, your contracts live onchain and need to be accessible from your React app. The `manifest.ts` file tells your game frontend:
- **Which game world to connect to** (via world address from deployment)
- **Where your game systems are deployed** (spawn_player, train, mine, rest, etc.)
- **How to structure your game data** (Player models, achievement events)
- **Which network environment you're targeting** (local, testnet, mainnet)

When you deploy with Dojo, the system generates manifest files containing all the contract addresses and schemas your frontend needs. The manifest system automatically selects the right deployment data based on your environment.

## 🔧 Manifest Sources and Networks

### `localhost` - Local Development
```typescript
import localhost from "../../../contract/manifest_dev.json";
```
Your local Katana deployment manifest, automatically generated when you run contracts locally.
- **Generated by**: Dojo deployment in local development
- **Contains**: Local contract addresses (game system at `0x19d9e6b...`)
- **Network**: Katana (localhost:5050)
- **Game Systems**: All game functions (spawn_player, train, mine, rest)

### `sepolia` - Testnet Deployment  
```typescript
import sepolia from "./manifest_sepolia.json";
```
Sepolia testnet deployment with free testnet tokens for safe testing.
- **Purpose**: Safe testing environment before mainnet
- **Network**: Sepolia testnet
- **Default fallback**: Used when environment is invalid or missing
- **Game Contract**: Deployed at `0x31b119987...` on Sepolia

### `mainnet` - Production Deployment
```typescript
import mainnet from "./manifest_sepolia.json"; // change for the right mainnet manifest
```
**⚠️ Currently using sepolia placeholder** - update with actual mainnet manifest for production.
- **Network**: Starknet mainnet
- **Security**: Real assets and gameplay value at stake

### `slot` - Slot Deployment
```typescript
import slot from "./manifest_sepolia.json"; // change for the right slot manifest
```
**⚠️ Currently using sepolia placeholder** - update with actual slot manifest when deploying.
- **Purpose**: Specialized deployment environment for Slot infrastructure

## 🏗️ Manifest Structure

Each manifest contains complete deployment information:

```json
{
  "world": {
    "address": "0x11097187dc00f79265f35e73ba674b792624f77dfa239e381dfc6744e1c8265",
    "class_hash": "0x4c60dc46a8ca8bb47675b7b914053cef769afbf0e340523187336b72bd71d1f",
    "name": "Full-Starter-React"
  },
  "contracts": [
    {
      "address": "0x19d9e6beac2177d4f48014861f4eead47192b9c450431cf31908f5359f49562",
      "systems": ["spawn_player", "train", "mine", "rest", "upgrade"]
    }
  ]
}
```

**Key Information**:
- **World Address**: Central registry for your game world
- **Contract Addresses**: Where game systems are deployed
- **System Functions**: Available game actions (train, mine, rest)
- **Class Hashes**: Contract implementation references

## 🌍 Environment-Based Selection

### Type Safety with DeployType
```typescript
type DeployType = keyof typeof manifests;
```
Creates a union type `"localhost" | "mainnet" | "sepolia" | "slot"` ensuring only valid deployment types can be used. TypeScript will catch typos and invalid environment configurations at compile time.

### Manifest Object Structure
```typescript
const manifests = {
  localhost,
  mainnet,
  sepolia,
  slot,
};
```
Centralizes all deployment configurations in one place. Keys match `VITE_PUBLIC_DEPLOY_TYPE` values for direct environment-based selection.

### Smart Environment Selection
```typescript
const deployType = import.meta.env.VITE_PUBLIC_DEPLOY_TYPE as string;

export const manifest = deployType in manifests
  ? manifests[deployType as DeployType]
  : sepolia;
```

**Selection Logic**:
1. Reads `VITE_PUBLIC_DEPLOY_TYPE` from environment
2. Checks if the value matches a valid manifest key
3. Uses the matching manifest or falls back to sepolia for safety

**Fallback Strategy**: Defaults to sepolia testnet when:
- Environment variable is missing
- Environment variable has invalid value
- Build process doesn't include environment configuration

## 🔄 Integration with Other Files

### Dojo Configuration
The manifest feeds directly into your Dojo config:

```typescript
// dojoConfig.ts
import { manifest } from "../config/manifest";

export const dojoConfig = createDojoConfig({
    manifest, // World address and contract data from deployment
    masterAddress: VITE_PUBLIC_MASTER_ADDRESS || '',
    masterPrivateKey: VITE_PUBLIC_MASTER_PRIVATE_KEY || '',
    rpcUrl: VITE_PUBLIC_NODE_URL || '',
    toriiUrl: VITE_PUBLIC_TORII || '',
});
```

### Contract Functions (setupWorld)
Your auto-generated contract functions use manifest data through the Dojo provider:

```typescript
// contracts.gen.ts
export function setupWorld(provider: DojoProvider) {
  const game_train = async (snAccount: Account | AccountInterface) => {
    return await provider.execute(
      snAccount,
      { contractName: "game", entrypoint: "train", calldata: [] },
      "full_starter_react"
    );
  };
  
  return {
    game: {
      train: game_train,
      mine: game_mine,
      rest: game_rest,
      spawnPlayer: game_spawnPlayer,
    },
  };
}
```

### Cartridge Connector Integration
The manifest provides contract addresses for wallet session policies:

```typescript
// cartridgeConnector.tsx
const getGameContractAddress = () => {
  return manifest.contracts[0].address; // Gets first contract address
};

const CONTRACT_ADDRESS_GAME = getGameContractAddress();

const policies = {
  contracts: {
    [CONTRACT_ADDRESS_GAME]: {
      methods: [
        { name: "spawn_player", entrypoint: "spawn_player" },
        { name: "train", entrypoint: "train" },
        { name: "mine", entrypoint: "mine" },
        { name: "rest", entrypoint: "rest" },
      ],
    },
  },
};
```

### Main Application Bootstrap
The manifest world address is used in SDK initialization:

```typescript
// main.tsx
const sdk = await init<SchemaType>({
  client: {
    toriiUrl: dojoConfig.toriiUrl,
    worldAddress: dojoConfig.manifest.world.address, // From manifest
  },
  domain: {
    name: "DojoGameStarter",
    version: "1.0",
    chainId: "KATANA",
    revision: "1",
  },
});
```
